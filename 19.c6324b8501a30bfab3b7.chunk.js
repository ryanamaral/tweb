(this.webpackJsonp=this.webpackJsonp||[]).push([[19],{102:function(e,t,n){"use strict";n.r(t);var i=n(12),o=n(54),a=n(63),r=n(79),d=n(91),c=n(58),s=n(55),l=n(22),p=n(1),u=n(11),g=n(7),m=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function d(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}c((i=i.apply(e,t||[])).next())}))};let f;const h=new o.a("page-signQR",!0,()=>f,()=>{f||(f=m(void 0,void 0,void 0,(function*(){const e=h.pageEl.querySelector(".auth-image"),t=document.createElement("div");t.classList.add("input-wrapper");const o=Object(u.a)("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});t.append(o);const v=e.parentElement,w=document.createElement("h4");Object(g._i18n)(w,"Login.QR.Title");const E=document.createElement("ol");E.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(e=>{const t=document.createElement("li");t.append(Object(g.i18n)(e)),E.append(t)}),v.append(w,E,t),o.addEventListener("click",()=>{d.default.mount(),_=!0});const y=(yield Promise.all([n.e(8).then(n.t.bind(null,104,7))]))[0].default;let _=!1;document.addEventListener("user_auth",()=>{_=!0,f=null},{once:!0});let k,b={ignoreErrors:!0};const O=t=>m(void 0,void 0,void 0,(function*(){try{let n=yield i.a.invokeApi("auth.exportLoginToken",{api_id:p.a.id,api_hash:p.a.hash,except_ids:[]},{ignoreErrors:!0});if("auth.loginTokenMigrateTo"===n._&&(b.dcId||(b.dcId=n.dc_id,i.a.setBaseDcId(n.dc_id)),n=yield i.a.invokeApi("auth.importLoginToken",{token:n.token},b)),"auth.loginTokenSuccess"===n._){const e=n.authorization;return i.a.setUserAuth(e.user.id),a.default.mount(),!0}if(!k||!Object(s.b)(k,n.token)){k=n.token;let t="tg://login?token="+Object(s.d)(n.token).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"");const i=new y({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:t,image:"assets/img/logo_padded.svg",dotsOptions:{color:"#000000",type:"rounded"},imageOptions:{imageSize:.75},backgroundOptions:{color:"#ffffff"},qrOptions:{errorCorrectionLevel:"L"}});let o;i.append(e),e.lastChild.classList.add("qr-canvas"),o=i._drawingPromise?i._drawingPromise:Promise.race([Object(l.d)(1e3),new Promise(e=>{i._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>e())},{once:!0})})]),yield o.then(()=>{Array.from(e.children).slice(0,-1).forEach(e=>{e.remove()})})}if(t){let e=Date.now()/1e3,t=n.expires-e-c.a.serverTimeOffset;yield Object(l.d)(t>5?5e3:1e3*t|0)}}catch(e){switch(e.type){case"SESSION_PASSWORD_NEEDED":console.warn("pageSignQR: SESSION_PASSWORD_NEEDED"),e.handled=!0,r.default.mount(),_=!0,f=null;break;default:console.error("pageSignQR: default error:",e)}}}));return yield O(!1),()=>m(void 0,void 0,void 0,(function*(){for(_=!1;!_&&!(yield O(!0)););}))}))),f.then(e=>{e()})});t.default=h}}]);